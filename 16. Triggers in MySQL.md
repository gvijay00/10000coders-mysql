

#  **Triggers in MySQL**

---

## ðŸ”¹ 1. Definition

* A **Trigger** in MySQL is a **special stored program** that is **automatically executed** (fired) in response to specific events on a table.
* Unlike stored procedures, **you donâ€™t call a trigger explicitly** â€“ it runs when its associated event (INSERT, UPDATE, DELETE) occurs.
* Triggers reside in the **system catalog** of the database.

---

## ðŸ”¹ 2. Trigger Events

Triggers can be associated with **DML operations**:

* **INSERT** â†’ Fires when a new row is inserted.
* **UPDATE** â†’ Fires when an existing row is updated.
* **DELETE** â†’ Fires when a row is deleted.

---

## ðŸ”¹ 3. Trigger Timing

* **BEFORE** â†’ Executes *before* the triggering event.
* **AFTER** â†’ Executes *after* the triggering event.

ðŸ“Œ Meaning:

* **BEFORE INSERT** â†’ Validate or modify data before insertion.
* **AFTER DELETE** â†’ Log deleted rows after deletion.

---

## ðŸ”¹ 4. Syntax to Create a Trigger

```sql
CREATE TRIGGER trigger_name
{BEFORE | AFTER} {INSERT | UPDATE | DELETE}
ON table_name
FOR EACH ROW
BEGIN
    -- SQL statements
END;
```

### Explanation:

* **trigger\_name** â†’ Name of the trigger.
* **BEFORE | AFTER** â†’ Timing of execution.
* **INSERT | UPDATE | DELETE** â†’ Event that activates the trigger.
* **table\_name** â†’ Table on which the trigger is created.
* **FOR EACH ROW** â†’ Executes once per row affected.

---

## ðŸ”¹ 5. Types of Triggers in MySQL

| Trigger Type  | When It Executes            | Common Use Case                                  |
| ------------- | --------------------------- | ------------------------------------------------ |
| BEFORE INSERT | Before inserting a new row  | Validate or modify data before inserting         |
| AFTER INSERT  | After a new row is inserted | Log insertion or update related tables           |
| BEFORE UPDATE | Before updating a row       | Prevent invalid updates (e.g., salary reduction) |
| AFTER UPDATE  | After updating a row        | Keep audit logs of changes                       |
| BEFORE DELETE | Before deleting a row       | Prevent deletion of important data               |
| AFTER DELETE  | After deleting a row        | Log deleted rows                                 |

---

## ðŸ”¹ 6. Creating Triggers in MySQL â€“ Examples

### âœ… 1. BEFORE INSERT Trigger

Ensures that employee salaries are always â‰¥ 3000.

```sql
DELIMITER //

CREATE TRIGGER before_insert_employee
BEFORE INSERT ON employees
FOR EACH ROW
BEGIN
    IF NEW.salary < 3000 THEN
        SET NEW.salary = 3000;
    END IF;
END //

DELIMITER ;
```

ðŸ“Œ **Explanation**

* `NEW.salary` â†’ Refers to the value being inserted.
* If salary is below 3000, it is modified before insertion.

---

### âœ… 2. AFTER INSERT Trigger

Logs every new employee into `employee_log`.

```sql
DELIMITER //

CREATE TRIGGER after_insert_employee
AFTER INSERT ON employees
FOR EACH ROW
BEGIN
    INSERT INTO employee_log (employee_id, action, log_time)
    VALUES (NEW.id, 'INSERTED', NOW());
END //

DELIMITER ;
```

ðŸ“Œ **Explanation**

* Inserts a log entry each time a new employee is added.

---

### âœ… 3. BEFORE UPDATE Trigger

Prevents salary reduction.

```sql
DELIMITER //

CREATE TRIGGER before_update_employee
BEFORE UPDATE ON employees
FOR EACH ROW
BEGIN
    IF NEW.salary < OLD.salary THEN
        SET NEW.salary = OLD.salary; -- Prevents decrease
    END IF;
END //

DELIMITER ;
```

ðŸ“Œ **Explanation**

* `OLD.salary` â†’ Existing value before update.
* If the new salary is less than the old one, update is blocked.

---

### âœ… 4. AFTER UPDATE Trigger

Logs salary changes.

```sql
DELIMITER //

CREATE TRIGGER after_update_salary
AFTER UPDATE ON employees
FOR EACH ROW
BEGIN
    INSERT INTO salary_log (employee_id, old_salary, new_salary, change_date)
    VALUES (NEW.id, OLD.salary, NEW.salary, NOW());
END //

DELIMITER ;
```

ðŸ“Œ **Explanation**

* Logs old and new salary values after every update.

---

### âœ… 5. BEFORE DELETE Trigger

Prevents deletion of managers.

```sql
DELIMITER //

CREATE TRIGGER before_delete_employee
BEFORE DELETE ON employees
FOR EACH ROW
BEGIN
    IF OLD.role = 'Manager' THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Cannot delete a Manager!';
    END IF;
END //

DELIMITER ;
```

ðŸ“Œ **Explanation**

* `SIGNAL` raises a custom error.
* Deletion of rows where role = Manager is blocked.

---

### âœ… 6. AFTER DELETE Trigger

Logs deleted employees.

```sql
DELIMITER //

CREATE TRIGGER after_delete_employee
AFTER DELETE ON employees
FOR EACH ROW
BEGIN
    INSERT INTO employee_log (employee_id, action, log_time)
    VALUES (OLD.id, 'DELETED', NOW());
END //

DELIMITER ;
```

ðŸ“Œ **Explanation**

* `OLD.id` refers to the deleted rowâ€™s ID.
* Inserts a record into `employee_log` after deletion.

---

## ðŸ”¹ 7. Viewing & Dropping Triggers

* **View All Triggers**

```sql
SHOW TRIGGERS;
```

* **View Specific Trigger Code**

```sql
SHOW CREATE TRIGGER trigger_name;
```

* **Drop a Trigger**

```sql
DROP TRIGGER IF EXISTS trigger_name;
```

---

## ðŸ”¹ 8. Limitations of Triggers

* A table can have **only one trigger per event per timing**
  (Example: only 1 BEFORE INSERT and 1 AFTER INSERT per table).
* Cannot call triggers directly (they execute automatically).
* Can make debugging harder if too many triggers exist.
* Performance overhead if triggers contain complex logic.

---

## ðŸ”¹ 9. Advantages of Triggers

1. **Automation** â€“ Enforces rules automatically.
2. **Data Integrity** â€“ Ensures consistency (e.g., prevent negative salary).
3. **Auditing** â€“ Keeps track of changes via log tables.
4. **Security** â€“ Prevents unauthorized operations.

---

## ðŸ”¹ 10. Summary Table

| Feature           | Description / Example                             |
| ----------------- | ------------------------------------------------- |
| **Definition**    | Auto-executed stored program responding to events |
| **Events**        | INSERT, UPDATE, DELETE                            |
| **Timing**        | BEFORE, AFTER                                     |
| **NEW**           | Refers to new values (INSERT/UPDATE)              |
| **OLD**           | Refers to existing values (UPDATE/DELETE)         |
| **View Triggers** | `SHOW TRIGGERS;`                                  |
| **Drop Trigger**  | `DROP TRIGGER trigger_name;`                      |
| **Use Cases**     | Logging, validation, security, automation         |

---